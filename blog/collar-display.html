<!doctype html>
<html lang="en">
		<head>
				<meta name="viewport" content="width=device-width, initial-scale=1.0" />
				<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
				<link rel="stylesheet" href="../css/global.css">
				<meta charset="utf-8">
				<title>itshe.dog | Collar Display</title>
		</head>
		<body class="bg-slate-950 flex items-center justify-center">
				<div class="container borzoi w-2xl mt-8 shadow-2xl" style="background: linear-gradient(180deg, rgb(89, 19, 84) 35%, rgb(54, 6, 55) 100% );">
						<header class="w-full text-2xl p-4 flex items-center justify-between bg-violet-600">
								<h1 class="font-semibold text-white sm:text-sm text-xl">
										Itchydog's Borzoi Enclosure
								</h1>
								<div class="links text-sm">
										<a class="text-gray-300 mr-4 hover:text-pink-300" href="../index.html">home</a>
										<a class="text-gray-300 mr-4 hover:text-pink-300" href="../blog.html">blog</a>
										<a class="text-gray-300 hover:text-pink-300" href="../about.html">about</a>
								</div>
						</header>
						<div class="p-4 text-white article">
                <img src="https://media1.tenor.com/m/IdNGe_sZg5oAAAAC/borzoigaming-borzoi.gif"/>
                <h2 class="text-2xl mt-4 font-bold">Collar Display Project</h2>
                <p>2025-04-21</p>
                <hr class="mt-2 opacity-20"/>
                <p class="mt-4">
                  Hi! I have finally finished* a project that's been on my mind since I started learning electronics - a Collar Display!</p>
                <p class="mt-4">I wear my collar everywhere, and I have a beautiful, bone shaped tag with "Cassiopeia" engraved on it, it's really nice and I love it! But one of
the first projects that appeared in my (very limited) mind was a collar tag made out of seven segment displays!</p>
              <p class="mt-4">To be completeeeely honest this project started with an OLED display in mind, but I came to a conclusion that that wasn't the best of ideas halfway through, so there's that!</p>
                <p class="mt-4">In this post I just want to yap about how I made it work and what I used to make it work!</p>
                <img class="mt-4 h-50" alt="picture of me holding a PCB with four seven segment displays displaying 'cass'" src="../img/blog/display1.jpg"> 
                <h2 class="mt-4 font-bold text-xl">AVR!! AVR!!! AVR EVERYWHERE</h2>
                <p class="mt-4">
                  I love AVR Microcontrollers, I am known to some as the <i>AVR Witch</i> since I can do almost <b>anything</b> using them. ATTiny85 was my first MCU ever, and I fell in love with that little guy. This project was supposed to run on ATTiny85 with a shift register to send data to seven segment displays. The issue was that I needed the board to be relatively small, to host most of its electronics on the back side while keeping seven segment displays in the front.
                </p>
            <p class="mt-4">The issue here was that I wasn't able to design a small board that also featured a shift register (due to the HUGE CR2032 battery holder). I decided to simply send data in parallel, so I needed enough pins to turn on/off displays and also provide signals to them to display characters. </p>
            <p class="mt-4">That was the point where I thought it would be a good idea to try out a different microcontroller, I heard lots about <b>CH32V003</b> so I ordered a dev board and a few QFN and TSSOP20 packaged microcontrollers. I managed to program the microcontroller using their STM32 CubeIDE wannabe software (and HAL) and got the whole project working on a breadboard!</p>
             <p class="mt-4">
                 I actually liked <b>CH32V003</b> a LOT. It's an excellent microcontroller for its price! I immediately sat down to design a board that would use the TSSOP20 version of CH32V003. I finished the design and sent it off to JLCPCB to produce it.
            </p>
            <p class="mt-4">When the boards arrived I realised that the footprint for my MCU was <i>incorrect</i>. It turns out that KiCad (at least used to) assigned SOP20 to a microcontroller that was <b>clearly</b> labeled as being in a TSSOP20 package. Not only the package was wrong, but the pinout was also all over the place. I realized that I can't really trust KiCad on it, and I didn't want to bother with installing external symbol/footprint libraries for CH32V003.</p>
          <p class="mt-4">I decided that the best thing I can do is to reach for something I know well and can trust KiCad with having correct footprints for. I also had to keep in mind that I would need a lot of pins (7 for driving LEDs and 4 for turning LEDs off/on) and I landed on <b>ATTiny2313a</b>.</p>
						<h2 class="mt-4 font-bold text-xl">How does it work?</h2>
            <p class="mt-4">
              Seven segment displays I used are common-cathode SMD mount seven segment displays. Keeping their CC line high basically disables the display, while pulling it low will enable it.
              We also have seven pins of our MCU used to actually provide our displays with data (for example, a character "C").
            </p>
            <p class="mt-4">
              So the idea is (aside from doing it really fucking fast):
            </p>
            <ol class="list-decimal pl-8">
              <li>Pull all displays HIGH (turn off all displays)</li>
              <li>Pull the desired display LOW</li>
              <li>Put our LED data on the data pins</li>
              <li>After that's done, go back to 1.</li>
            </ol>
            <p class="mt-4">
              And that's basically it, it can be achieved on a AVR MCU very easily:
            </p>
            <pre class="mt-4 bg-black p-2">
// PORTB pins are connected to our displays' common cathodes	

// PORTD is our data, or in simpler terms, a character we want to display

// "character" function is a function that returns a uint8_t based off of what alphanumeric character we gave it, imagine it's a huge switch case

PORTB = 255;
PORTD = character('c');
PORTB &= ~(1 << PB0);
PORTB = 255;
PORTD = character('a');
PORTB &= ~(1 << PB1);
PORTB = 255;
PORTD = character('s');
PORTB &= ~(1 << PB2);
PORTB = 255;
PORTD = character('s');
PORTB &= ~(1 << PB3);
PORTB = 255;
            </pre>
            <p class="mt-4">
              I designed a very simple board around ATTiny2313, a few resistors (to limit the current flowing to displays), a decoupling capacitor and a pull-up resistor for the reset line. I also added a button that upon pressing, would iterate over different things to display!
  Here are some pictures of the board without components (yes, I did tear one of the programming pins out by accident, yes, i am stupid)
            </p>
            <img class="mt-4 h-60" src="../img/blog/front.jpg">
            <img class="mt-4 h-60" src="../img/blog/back.jpg">
            
            <p class="mt-4">Also, an image of it mounted on my collar!</p>
            <img class="mt-4 h-60" src="../img/blog/me.jpg"> 
            <p class="mt-4">Since the prototype worked, I decided I want to decrease the size of the board even further! Right now I'm working on an even more compact design that will include QFN ATTiny2313a!</p>
            <img class="mt-4 h-60" src="../img/blog/newdesign.jpg"> 
            <p class="mt-4">I'm not going to lie, I am a little bit tempted to try CH32V003 again, just for the lolz, mostly because I want to branch out into other microcontrollers. If I decide to go with WCH, I'll quadruple check that everything is okay, I'll surely post an update once I have anything to show! See ya <3</p>
            </div>
						<footer class="p-4 text-white bg-violet-900 text-center flex justify-center items-center flex-col mt-4 text-xs">
							<p>fuck copyright (itchydog's website :3)</p>
						</footer>
				</div>
		</body>
</html>
